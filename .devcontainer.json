{
    "name": "Home Assistant + Claude Code Development",
    "image": "ghcr.io/home-assistant/devcontainer:dev",
    "appPort": [
        "8123:8123"
    ],
    "forwardPorts": [
        8123
    ],
    "portsAttributes": {
        "8123": {
            "label": "Home Assistant",
            "onAutoForward": "notify"
        }
    },
    "otherPortsAttributes": {
        "onAutoForward": "silent"
    },
    "runArgs": [
        "--privileged",
        "--cap-add=NET_ADMIN",
        "--cap-add=NET_RAW"
    ],
    "remoteEnv": {
        "LOCAL_WORKSPACE_FOLDER": "${localWorkspaceFolder}",
        "DEVCONTAINER": "true"
    },
    "containerEnv": {
        "WORKSPACE_DIRECTORY": "${containerWorkspaceFolder}",
        "ANTHROPIC_API_KEY": "${localEnv:ANTHROPIC_API_KEY}",
        "TZ": "${localEnv:TZ:Europe/Rome}"
    },
    "mounts": [
        "source=/var/run/docker.sock,target=/var/run/docker.sock,type=bind",
        "source=claude-code-bashhistory,target=/commandhistory,type=volume"
    ],
    "postCreateCommand": "container install",
    "postStartCommand": "bash -c 'if [ -f /workspace/.devcontainer/init-firewall.sh ]; then sudo /workspace/.devcontainer/init-firewall.sh; fi'",
    "shutdownAction": "stopContainer",
    "customizations": {
        "vscode": {
            "extensions": [
                "ms-python.python",
                "ms-python.vscode-pylance",
                "ms-python.flake8",
                "ms-python.black-formatter",
                "ms-python.isort",
                "ms-python.mypy-type-checker",
                "charliermarsh.ruff",
                "tamasfe.even-better-toml",
                "redhat.vscode-yaml",
                "esbenp.prettier-vscode",
                "bradlc.vscode-tailwindcss",
                "ms-vscode.vscode-json",
                "dbaeumer.vscode-eslint",
                "eamodio.gitlens",
                "ryanluker.vscode-coverage-gutters"
            ],
            "settings": {
                "python.defaultInterpreterPath": "/usr/local/bin/python",
                "python.linting.enabled": true,
                "python.linting.pylintEnabled": false,
                "python.linting.flake8Enabled": true,
                "python.formatting.provider": "black",
                "python.sortImports.args": [
                    "--profile",
                    "black"
                ],
                "editor.formatOnSave": true,
                "editor.defaultFormatter": "charliermarsh.ruff",
                "editor.codeActionsOnSave": {
                    "source.organizeImports": "explicit",
                    "source.fixAll.eslint": "explicit"
                },
                "files.trimTrailingWhitespace": true,
                "terminal.integrated.defaultProfile.linux": "zsh",
                "terminal.integrated.profiles.linux": {
                    "bash": {
                        "path": "bash",
                        "icon": "terminal-bash"
                    },
                    "zsh": {
                        "path": "zsh"
                    }
                },
                "python.testing.pytestEnabled": true,
                "python.testing.unittestEnabled": false,
                "python.testing.pytestArgs": [
                    "tests"
                ]
            }
        }
    },
    "features": {
        "ghcr.io/anthropics/devcontainer-features/claude-code:1": {
            "version": "latest"
        },
        "ghcr.io/devcontainers/features/docker-in-docker:2": {
            "version": "latest"
        },
        "ghcr.io/devcontainers/features/git:1": {
            "version": "latest"
        },
        "ghcr.io/devcontainers/features/github-cli:1": {
            "version": "latest"
        }
    }
}